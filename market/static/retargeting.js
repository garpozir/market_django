(function(){!function(){var e=window.Cookies,n=window.Cookies=function(){function u(){var e=0;var n={};for(;e<arguments.length;e++){var t=arguments[e];for(var r in t){n[r]=t[r]}}return n}function a(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function e(f){function c(){}function t(e,n,t){if(typeof document==="undefined"){return}t=u({path:"/"},c.defaults,t);if(typeof t.expires==="number"){t.expires=new Date(new Date*1+t.expires*86400000)}t.expires=t.expires?t.expires.toUTCString():"";try{var r=JSON.stringify(n);if(/^[\{\[]/.test(r)){n=r}}catch(e){}n=f.write?f.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var i in t){if(!t[i]){continue}o+="; "+i;if(t[i]===true){continue}o+="="+t[i].split(";")[0]}return document.cookie=e+"="+n+o}function n(e,n){if(typeof document==="undefined"){return}var t={};var r=document.cookie?document.cookie.split("; "):[];var o=0;for(;o<r.length;o++){var i=r[o].split("=");var c=i.slice(1).join("=");if(!n&&c.charAt(0)==='"'){c=c.slice(1,-1)}try{var u=a(i[0]);c=(f.read||f)(c,u)||a(c);if(n){try{c=JSON.parse(c)}catch(e){}}t[u]=c;if(e===u){break}}catch(e){}}return e?t[e]:t}c.set=t;c.get=function(e){return n(e,false)};c.getJSON=function(e){return n(e,true)};c.remove=function(e,n){t(e,"",u(n,{expires:-1}))};c.defaults={};c.withConverter=e;return c}return e(function(){})}();n.noConflict=function(){return window.Cookies=e,n}}();function supportsLocalStorage(){try{localStorage.setItem("1","1");localStorage.removeItem("1");return !0}catch(e){return !1}}function supportsCookie(){try{Cookies.set("1","1");Cookies.remove("1");return !0}catch(e){return !1}}var useLocalStorage=supportsLocalStorage();var useCookie=!useLocalStorage&&supportsCookie();function store(k,v,e){if(useLocalStorage){localStorage.setItem(k,v)}else{if(useCookie){Cookies.set(k,v,{expires:e})}}}function del(k){if(useLocalStorage){localStorage.removeItem(k)}else{if(useCookie){Cookies.remove(k)}}}function storeT(k,v,e){store(k,v,e);store(k+":t",Date.now(),e)}function load(k){if(useLocalStorage){return localStorage.getItem(k)}if(useCookie){return Cookies.get(k)}return null}function loadNx(k,l){var v=load(k);var t=load(k+":t");if(t){var a=Date.now()-t;if(a<0||a>l){del(k);del(k+":t");return null}}return v}function storeObj(k,v,e){store(k,JSON.stringify(v),e)}function loadObj(k){var v=load(k);if(v){return JSON.parse(v)}else{return null}}function once(k,block){if(!load(k)){store(k,1,999);try{block()}catch(e){console.log(e)}}}function doInSession(k,block){sessionStorage.setItem(k,"1");try{block()}catch(e){console.log(e)}}function onceInSession(k,block){if(!sessionStorage.getItem(k)){doInSession(k,block)}}var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod==="attachEvent"?"onmessage":"message";var fidKey="MEDIAAD_USER_ID";var fidHolder={val:null,listeners:[],set value(val){this.val=val;while(this.listeners.length>0){this.listeners.pop()(val)}},get value(){return this.val},listen:function(listener){this.listeners.push(listener)}};function withFid(callback){var v=fidHolder.value;if(v){try{callback(v)}catch(e){console.log(e)}}else{fidHolder.listen(function(v){if(v){try{callback(v)}catch(e){console.log(e)}}})}}fidHolder.value=load(fidKey);eventer(messageEvent,function(e){try{var message=e.data||e.message;if(message===null||message===undefined||typeof message.indexOf==="undefined"){return}if(message.indexOf("mediaad-fid:")===0){var fid=message.split(":")[1];fidHolder.value=fid;store(fidKey,fid,999)}}catch(e){console.log(e)}});var queryParams;if("URLSearchParams" in window){queryParams=new URLSearchParams(window.location.search);if(queryParams.has("utm_ma")){storeT("ma-iid",queryParams.get("utm_ma"),1)}}else{queryParams=window.location.search.substr(1).split("&").reduce(function(q,query){var chunks=query.split("=");var key=chunks[0];var value=decodeURIComponent(chunks[1]);value=isNaN(Number(value))?value:Number(value);return(q[key]=value,q)},{});if(queryParams.utm_ma){storeT("ma-iid",queryParams.utm_ma,1)}}function docReady(fn){if(document.readyState==="complete"||document.readyState==="interactive"){setTimeout(fn,1)}else{document.addEventListener("DOMContentLoaded",fn)}}function getCurrentPath(){return decodeURIComponent(location.href.substr(location.origin.length))}function appendIframe(src){if(src===null||src===undefined){return}var elem=document.createElement("iframe");elem.style.display="none";elem.src=src;try{document.body.appendChild(elem)}catch(e){console.log(e)}}var allTags=[{id:6389,title:"mediaad-retarget",pattern_type:"startsWith",query:"/",trigger_type:"showPage",custom_script:null,css_selector:null,time_to_remain:0,element_id:"MED-qWBZn",domain:null,attribs:[]}];var pageTags=[];var htmlElementTagToCounter={};var tagToTimeoutCounter={};var currentPath=getCurrentPath();var timeouts=[];var API_URL="https://api.mediaad.org";var SERVE_URL="https://api.mediaad.org/v1/events";var MAX_INTERVAL_RESET=60;var hasProductJs=false;docReady(function(){appendIframe("https://mediacdn.mediaad.org/static/fingerprint.html");if(!hasProductJs){withFid(function(fid){var body={l:location.href};if(fid){body.m=fid;if(useLocalStorage){var y=localStorage.getItem("_yngt");var s=localStorage.getItem("sid");if(y){body.y=y}if(s){body.s=s}}}postV2("page/loaded",body)})}setTimeout(function(){getV1("session/10")},10000);updatePageTags();setInterval(function(){checkUrlChange()},1000)});function checkUrlChange(){var newPath=getCurrentPath();if(newPath!==currentPath){currentPath=newPath;refresh()}}function refresh(){var tempTimeouts=timeouts.slice();timeouts=[];var counter=0;if(tempTimeouts.length===0){updatePageTags()}else{tempTimeouts.forEach(function(timeout){clearTimeout(timeout);if(++counter===tempTimeouts.length){updatePageTags()}})}}function updatePageTags(){pageTags=[];tagToTimeoutCounter={};htmlElementTagToCounter={};var counter=0;allTags.forEach(function(tag){if(domainMatches(tag)){collectAttribsValues(tag);if(isSuitable(tag)){pageTags.push(tag)}}if(++counter===allTags.length){checkTagsTrigger()}})}function attribKey(tag,attrib){return"ma-tag:"+tag.id+":"+attrib.id}function collectAttribsValues(tag){if(tag.attribs){tag.attribs.forEach(function(a){if(a.collectible){collectAttribValues(tag,a)}})}}function collectAttribValues(tag,attrib){var key=attribKey(tag,attrib);function set(vs){storeObj(key,vs,999)}function clr(){del(key)}function add(v){var vs=loadObj(key);if(vs){vs.push(v)}else{vs=[v]}set(vs)}function rem(v){var vs=loadObj(key);if(vs){var i=vs.indexOf(v);if(i>-1){if(vs.length>1){vs.splice(i,1);set(vs)}else{clr()}}}}setTimeout(function(){try{eval(attrib.script)}catch(e){console.log(e)}},1)}function loadAttribsValues(tag){var res={};if(tag.attribs){tag.attribs.forEach(function(attrib){res[attrib.id]=loadAttribValues(tag,attrib)})}return res}function loadAttribValues(tag,attrib){var vs;if(attrib.collectible){vs=loadObj(attribKey(tag,attrib))}else{try{vs=eval(attrib.script)}catch(e){console.log(e)}}if(vs){var res={};vs.forEach(function(v){if(res[v]){res[v]++}else{res[v]=1}});return res}else{return{}}}function checkTagsTrigger(){pageTags.forEach(function(tag){applyTriggerEvent(tag)})}function isPrefix(mainString,prefix){return(mainString.substring(0,prefix.length)===prefix)}function isPostfix(mainString,postfix){return(mainString.substring(mainString.length-postfix.length,mainString.length)===postfix)}function domainMatches(tag){if(tag.domain){var domain=location.hostname;if(domain!==tag.domain&&domain!=="www."+tag.domain&&"www."+domain!==tag.domain){return false}}return true}function isSuitable(tag){if(tag.pattern_type==="startsWith"){return isPrefix(currentPath,tag.query)}else{if(tag.pattern_type==="htmlElement"){htmlElementTagToCounter[tag.id]=0;var htmlElementCheckInterval=setInterval(function(){htmlElementTagToCounter[tag.id]=htmlElementTagToCounter[tag.id]+1;var element=document.getElementById(tag.element_id);if(element!=null||htmlElementTagToCounter[tag.id]>=MAX_INTERVAL_RESET){clearInterval(htmlElementCheckInterval)}if(element){applyTriggerEvent(tag)}},1000);timeouts.push(htmlElementCheckInterval);return false}else{if(tag.pattern_type==="endsWith"){return isPostfix(currentPath,tag.query)}else{if(tag.pattern_type==="equalsTo"){return currentPath===tag.query}else{if(tag.pattern_type==="contains"){return currentPath.includes(tag.query)}else{if(tag.pattern_type==="regex"){return new RegExp(tag.query).test(currentPath)}}}}}}}function applyTriggerEvent(tag){if(tag.trigger_type==="showPage"){assignTagToUser(tag)}else{if(tag.trigger_type==="clickOnElement"){if(!(tag.css_selector in tagToTimeoutCounter)){tagToTimeoutCounter[tag.css_selector]=0}var clickOnElementCheckInterval=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var elements=Array.prototype.slice.call(document.querySelectorAll(tag.css_selector));if(elements.length>0||tagToTimeoutCounter[tag.css_selector]>=MAX_INTERVAL_RESET){clearInterval(clickOnElementCheckInterval)}elements.forEach(function(element){element.addEventListener("click",function(){assignTagToUser(tag)})})},1000);timeouts.push(clickOnElementCheckInterval)}else{if(tag.trigger_type==="submitForm"){if(!(tag.css_selector in tagToTimeoutCounter)){tagToTimeoutCounter[tag.css_selector]=0}var submitFormCheckInterval=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var elements=Array.prototype.slice.call(document.querySelectorAll(tag.css_selector));if(elements.length>0||tagToTimeoutCounter[tag.css_selector]>=MAX_INTERVAL_RESET){clearInterval(submitFormCheckInterval)}elements.forEach(function(element){element.addEventListener("submit",function(){assignTagToUser(tag)})})},1000);timeouts.push(submitFormCheckInterval)}else{if(tag.trigger_type==="timeToStay"){var timeout=setTimeout(function(){assignTagToUser(tag)},tag.time_to_remain*1000);timeouts.push(timeout)}else{if(tag.trigger_type==="customScript"){try{var result=eval(tag.custom_script);if(result===true){assignTagToUser(tag)}}catch(e){console.log(e)}}}}}}}function assignTagToUser(tag){var c=loadNx("ma-iid",3600000);if(c){once("ma-pb:"+tag.id,function(){getV1("post-back?actionName="+tag.title+"&clickId="+c)})}var k="ma-tag:"+tag.id;var av=loadAttribsValues(tag);if(Object.keys(av).length>0){doInSession(k,function(){withFid(function(fid){postV1("tag?fid="+fid,{tagId:tag.id,av:av})})})}else{onceInSession(k,function(){withFid(function(fid){postV1("tag?fid="+fid,{tagId:tag.id})})})}}function postV1(link,obj){sendPostRequest(API_URL+"/v1/events/"+link,obj)}function postV2(link,obj){sendPostRequest(API_URL+"/v2/events/"+link,obj)}function sendPostRequest(link,obj){var xhr=new XMLHttpRequest();xhr.open("POST",link);xhr.withCredentials=!0;xhr.setRequestHeader("Content-Type","application/json; charset=utf-8");if(obj){xhr.send(JSON.stringify(obj))}else{xhr.send()}}function getV1(link){sendGetRequest(API_URL+"/v1/events/"+link)}function sendGetRequest(link){var xhr=new XMLHttpRequest();xhr.open("GET",link);xhr.send(null)}})();